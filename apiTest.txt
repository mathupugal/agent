import requests

import json

import time

def api_validator(url, method, headers=None, payload=None, expected_status=None):

    result = {

        "request": {

            "url": url,

            "method": method.upper(),

            "headers": headers if headers else {},

            "payload": payload,

            "expected_status_code": expected_status

        },

        "response": {},

        "result": ""

    }

    try:

        # Start time

        start_time = time.time()

        # Select method

        method = method.upper()

        if method == "GET":

            response = requests.get(url, headers=headers)

        elif method == "POST":

            response = requests.post(url, headers=headers, json=payload)

        elif method == "PUT":

            response = requests.put(url, headers=headers, json=payload)

        elif method == "PATCH":

            response = requests.patch(url, headers=headers, json=payload)

        elif method == "DELETE":

            response = requests.delete(url, headers=headers)

        else:

            result["result"] = f"FAIL - Unsupported HTTP method: {method}"

            return result

        # Response time

        response_time = round((time.time() - start_time) * 1000, 2)

        # Capture response data

        try:

            response_body = response.json()

        except ValueError:

            response_body = response.text

        result["response"] = {

            "actual_status_code": response.status_code,

            "response_body": response_body,

            "response_headers": dict(response.headers),

            "response_time_ms": response_time

        }

        # Compare status

        if expected_status is not None:

            if response.status_code == expected_status:

                result["result"] = "PASS"

            else:

                result["result"] = f"FAIL - Expected {expected_status}, got {response.status_code}"

        else:

            result["result"] = "PASS (No expected status provided)"

    except Exception as e:

        result["result"] = f"ERROR - {str(e)}"

    return result


# -----------------------------

# Example Usage

# -----------------------------

if __name__ == "__main__":

    url = "https://jsonplaceholder.typicode.com/posts"

    method = "POST"

    headers = {"Content-Type": "application/json"}

    payload = {"title": "foo", "body": "bar", "userId": 1}

    expected_status = 201

    output = api_validator(url, method, headers, payload, expected_status)

    print(json.dumps(output, indent=4))
 


{

  "request": {

    "url": "https://api.example.com/users",

    "method": "POST",

    "headers": {

      "Content-Type": "application/json",

      "Authorization": "Bearer xyz123"

    },

    "payload": {

      "name": "John",

      "email": "john@example.com"

    },

    "expected_status_code": 201

  },

  "response": {

    "actual_status_code": 201,

    "response_body": {

      "id": 45,

      "name": "John"

    },

    "response_headers": {

      "Content-Type": "application/json"

    },

    "response_time_ms": 118

  },

  "result": "PASS"

}
 
